(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{12:function(e,t,n){},13:function(e,t,n){},14:function(e,t,n){},16:function(e,t,n){"use strict";n.r(t);var s=n(1),a=n.n(s),c=n(7),r=n.n(c),i=(n(12),n(3)),d=n(2),o=(n(13),n(14),n(0));var u=function(e){var t=Object(s.useState)(""),n=Object(d.a)(t,2),a=n[0],c=n[1],r=Object(s.useState)(""),i=Object(d.a)(r,2),u=i[0],j=i[1],l=Object(s.useState)(""),b=Object(d.a)(l,2),O=b[0],h=b[1];return Object(o.jsx)("div",{children:Object(o.jsx)("div",{id:"login-modal",children:Object(o.jsxs)("div",{className:"content",children:[Object(o.jsx)("h2",{children:"Login"}),Object(o.jsx)("div",{children:Object(o.jsxs)("label",{children:["Chat URL ",Object(o.jsx)("br",{}),Object(o.jsx)("input",{id:"url",type:"text",value:a,onChange:function(e){return c(e.target.value)}})]})}),Object(o.jsx)("div",{children:Object(o.jsxs)("label",{children:["Username ",Object(o.jsx)("br",{}),Object(o.jsx)("input",{id:"username",type:"text",value:u,onChange:function(e){return j(e.target.value)}})]})}),Object(o.jsx)("div",{children:Object(o.jsxs)("label",{children:["Password ",Object(o.jsx)("br",{}),Object(o.jsx)("input",{id:"password",type:"password",value:O,onChange:function(e){return h(e.target.value)}})]})}),Object(o.jsx)("div",{children:Object(o.jsx)("button",{type:"submit",disabled:!(a&&u&&O),onClick:function(){var t=new XMLHttpRequest,n=new FormData;n.append("password",O),n.append("username",u),t.open("POST",a+"/login"),t.onreadystatechange=function(){if(4==this.readyState)if(201===this.status){e.setShowModal(!1);var t=JSON.parse(this.responseText),n=t.message_token,s=t.stream_token;e.setStatus("connected"),e.setMessageToken(n),e.setStreamToken(s),e.setChatURL(a)}else 403===this.status?alert("Invalid username or password"):409===this.status?alert(u.value+" is already logged in"):alert(this.status+" failure to /login")},t.send(n)},children:"Login"})})]})})})};var j=function(){var e=Object(s.useState)("disconnected"),t=Object(d.a)(e,2),n=t[0],a=t[1],c=Object(s.useState)(""),r=Object(d.a)(c,2),j=r[0],l=r[1],b=Object(s.useState)([]),O=Object(d.a)(b,2),h=O[0],v=O[1],S=Object(s.useState)(""),g=Object(d.a)(S,2),f=g[0],p=g[1],x=Object(s.useState)(null),m=Object(d.a)(x,2),w=m[0],L=m[1],y=Object(s.useState)(null),C=Object(d.a)(y,2),T=C[0],k=C[1],E=Object(s.useState)(new Set),J=Object(d.a)(E,2),M=J[0],N=J[1],P=Object(s.useState)(!0),R=Object(d.a)(P,2),U=R[0],D=R[1];function F(){a("disconnected"),l(""),v([]),p(""),L(null),k(null),N(new Set),D(!0)}function A(e){var t=new Date(1e3*e);return t.toLocaleDateString("en-US")+" "+t.toLocaleTimeString("en-US")}return Object(s.useEffect)((function(){console.log("this is users: "),console.log(M)}),[M]),Object(s.useEffect)((function(){if(f&&T){var e=new EventSource(f+"/stream/"+T);e.addEventListener("Message",(function(e){var t=JSON.parse(e.data);h.push(A(t.created)+" ("+t.user+") "+t.message),v(Object(i.a)(h))}),!1),e.addEventListener("Users",(function(e){var t=new Set(JSON.parse(e.data).users);N(t)}),!1),e.addEventListener("Join",(function(e){var t=JSON.parse(e.data);N((function(e){return new Set([].concat(Object(i.a)(e),[t.user]))})),h.push(A(t.created)+" JOIN: "+t.user),v(Object(i.a)(h)),a("connected")}),!1),e.addEventListener("Part",(function(e){var t=JSON.parse(e.data),n=new Set([t.user]);N((function(e){return new Set(Object(i.a)(e).filter((function(e){return!n.has(e)})))})),h.push(A(t.created)+" PART: "+t.user),v(Object(i.a)(h))}),!1),e.addEventListener("Disconnect",(function(t){e.close(),F()}),!1),e.addEventListener("error",(function(e){2==e.target.readyState?F():(a("disconnected"),console.log("Disconnected, retrying"))}),!1),e.addEventListener("ServerStatus",(function(e){var t=JSON.parse(e.data);h.push(A(t.created)+" STATUS: "+t.status),v(Object(i.a)(h))}),!1)}}),[f,T]),Object(o.jsxs)("div",{children:[Object(o.jsxs)("section",{id:"container",children:[Object(o.jsx)("h1",{id:"title",class:n,children:"CS291 Chat"}),Object(o.jsxs)("div",{id:"window",children:[Object(o.jsx)("div",{id:"chat",children:h.map((function(e){return Object(o.jsx)("div",{children:e})}))}),Object(o.jsxs)("div",{id:"user_window",children:[Object(o.jsx)("h2",{children:"Online"}),Object(o.jsx)("ul",{id:"users"}),Array.from(M).map((function(e){return Object(o.jsx)("ul",{children:e})}))]})]}),Object(o.jsxs)("div",{children:[Object(o.jsx)("input",{id:"message-text",disabled:"disconnected"==n,type:"text",value:"disconnected"==n?"Please connect to send messages.":j,onChange:function(e){return l(e.target.value)}}),Object(o.jsx)("button",{id:"message-send-btn",disabled:!j,onClick:function(){var e=new FormData;e.append("message",j);var t=new XMLHttpRequest;t.open("POST",f+"/message"),t.setRequestHeader("Authorization","Bearer "+w),t.onreadystatechange=function(e){4==e.target.readyState&&403!=e.target.status&&null!=w&&L(e.target.getResponseHeader("token"))},t.send(e),l("")},children:"Send"})]})]}),U&&Object(o.jsx)(u,{setStatus:a,setMessageToken:L,setStreamToken:k,showModal:!0,setChatURL:p,setShowModal:D})]})},l=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,17)).then((function(t){var n=t.getCLS,s=t.getFID,a=t.getFCP,c=t.getLCP,r=t.getTTFB;n(e),s(e),a(e),c(e),r(e)}))};r.a.render(Object(o.jsx)(a.a.StrictMode,{children:Object(o.jsx)(j,{})}),document.getElementById("root")),l()}},[[16,1,2]]]);
//# sourceMappingURL=main.e4ed71ab.chunk.js.map